{% extends 'base.html' %}

{% block title %} Search Results-BCU-Search {% endblock %}

{% block css %}
<link href="{{ url_for('search_page_bp.static', filename='css/search_page.css') }}" rel="stylesheet">
{% endblock %}


{% block content %}
<div class="container-fluid text-center py-1">
    <div class="py-2">
        <p><a href="{{ url_for('home_bp.search_form') }}">Go back to home page</a></p>
    </div>

    <div class="py-2 my-2">
        {% if magazine_filter %}
        <p1 class="display-6">
            <span class="fw-bold">{{ details_for_searched_term.total }}</span> results found for
            <span class="text-success">{{ searched_term }}</span> in
            <span class="fw-bold">{{magazine_filter}}</span>
        </p1>
        {% else %}
        <p1 class="display-6">
            <span class="fw-bold">{{ details_for_searched_term.total }}</span> results found for
            <span class="text-success">{{searched_term }}</span>
        </p1>
        {% endif %}
    </div>

    <div class="row">
        <div class="col-sm-4">
            <button class="btn btn-primary p-2" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapseCountResults">
                <i class="bi bi-view-list"></i>
                Number of results displayed by magazine name
            </button>
            <div class="collapse show" id="collapseCountResults">
                {% for magazine_name, count in distinct_magazines_and_count %}
                <div class="my-1">
                    <form action="{{url_for('search_page_bp.search_for_term')}}">
                        <button class="btn btn-outline-dark border-0" type="submit" id="magazine_filter"
                            name="magazine_filter" value="{{magazine_name}}">
                            <p1><i class="bi bi-link"></i> {{magazine_name}} ({{count}} results)</p1><br>
                            <input type="hidden" id="search_box" name="search_box" value="{{session['s_word']}}">
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="col-sm-8">
            <ul>
                {% for name, year, magazine_number, magazine_page, magazine_number_link, rowid in
                details_for_searched_term%}
                <div class="row border-bottom border-success me-1">
                    <div class="col-sm-6 text-bg-light vstack gap-1 py-2">
                        <p1 class="lead text-center">{{name}}</p1>
                        <p1 class="lead text-center">{{year}}</p1>
                        <p1 class="lead text-center">{{magazine_number}}</p1>
                        <p1 class="lead text-center">Page {{magazine_page}}</p1>
                        <p1 class="lead text-center">
                            <a href="{{magazine_number_link}}" target="_blank" title="Access magazine pdf on BCU site"
                                class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                                <i class="bi bi-box-arrow-up-right"></i> Open Magazine
                            </a>
                        </p1>
                    </div>
                    <div class="col-sm-6 text-start py-2">
                        {% for preview_rowid, preview_content in previews %}
                        {% if preview_rowid == rowid%}
                        {{preview_content}}
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </ul>
        </div>
    </div>


</div>

{% for page_num in details_for_searched_term.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=1) %}
{% if page_num %}
<a
    href="{{ url_for('search_page_bp.search_for_term', magazine_filter=magazine_filter, search_box=searched_term, page=page_num)}}">{{
    page_num}}</a>
{% else %}
...
{% endif %}
{% endfor %}

{% endblock %}